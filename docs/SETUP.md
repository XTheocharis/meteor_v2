# Meteor v2 Setup Guide

## Prerequisites

- **Comet browser** installed (Chromium-based browser by Perplexity)
- **Python 3.10+** with pip
- **Windows 10/11**, **macOS 10.15+**, or **Linux**

## Quick Start

### 1. Install Dependencies

```bash
cd meteor_v2
pip install -r launcher/requirements.txt
```

### 2. Extract Base Extensions (One-Time)

If you haven't already extracted the Comet extensions:

```bash
# From the Meteor root directory
python tools/extract_all.py
```

This extracts:
- `Extracted/perplexity/` - Main Comet extension
- `Extracted/comet_web_resources/` - Web resources extension
- `Extracted/agents/` - Agent extension (optional)

### 3. Set Up Patched Extensions

```bash
python tools/setup.py
```

This creates `patched_extensions/` with Meteor modifications:
- DNR telemetry blocking rules
- SDK neutralization content scripts
- Feature flag interceptor (MCP UI force-enable)
- Preference enforcement module

### 4. (Optional) Apply PAK Modifications

For maximum telemetry blocking at the static resource level:

```bash
python tools/build_pak.py -o output/resources.pak
```

Then copy `output/resources.pak` to your Comet installation directory.

### 5. Launch Browser

```bash
python launcher/launcher.py
```

On Windows, you can also use:

```powershell
.\launcher\launcher.ps1
```

## First Run Verification

After launching, verify all layers are working:

### 1. MCP UI (Model Context Protocol)

Navigate to **Settings > Connectors** (or `perplexity.ai/settings/my-connectors`).

You should see:
- "Custom Connector" button
- Ability to add stdio MCP servers
- Remote MCP server tab
- DXT packages section

### 2. uBlock Origin

Click the uBlock Origin icon in the toolbar.

You should see:
- Blocking statistics
- No MV2 deprecation warnings
- All 41 filter lists loaded

### 3. Telemetry Blocking

Open DevTools (F12) > Network tab.

Verify NO requests to:
- `browser-intake-datadoghq.com`
- `sdk-api-v1.singular.net`
- `fscdn.eppo.cloud`
- `irontail.perplexity.ai`
- `api.mixpanel.com`
- `.ingest.sentry.io`

### 4. New Tab Redirection

Open a new tab. It should load:
- `https://www.perplexity.ai/b/home`

NOT:
- `chrome://newtab`
- `comet://newtab`

## Directory Structure After Setup

```
meteor_v2/
├── launcher/
│   ├── config.yaml         # Configuration
│   ├── launcher.py         # Python launcher
│   ├── launcher.ps1        # PowerShell launcher
│   └── requirements.txt    # Dependencies
│
├── patches/
│   └── perplexity/
│       ├── meteor-prefs.js           # Preference enforcement
│       ├── manifest.patch.json       # Manifest modifications
│       ├── rules/telemetry.json      # 16 DNR rules
│       └── content/
│           ├── sdk-neutralizer.js    # SDK stubs
│           └── feature-flags.js      # Eppo interceptor
│
├── patched_extensions/     # Generated by setup.py
│   ├── perplexity/         # Modified extension
│   ├── comet_web_resources/
│   └── agents/
│
├── ublock/
│   ├── ublock-defaults.json  # uBlock configuration
│   └── download.py           # Download script
│
├── ublock-origin/          # Downloaded by launcher
│
└── tools/
    ├── setup.py            # One-time setup
    ├── pak_mods.py         # PAK modifications
    └── build_pak.py        # Build modified PAK
```

## Configuration

Edit `launcher/config.yaml` to customize:

### Browser Executable

```yaml
browser:
  executable: "C:\\Path\\To\\comet.exe"
```

Leave empty for auto-detection.

### Feature Flags

Disable additional Chromium features:

```yaml
browser:
  disable_features:
    - "YourFeatureHere"
```

### Windows Registry Policies

Additional privacy policies (Windows only):

```yaml
registry:
  policies:
    YourPolicy: 0
```

## Troubleshooting

See [TROUBLESHOOTING.md](TROUBLESHOOTING.md) for common issues.

## Updating

When Comet updates:

1. Re-extract extensions: `python tools/extract_all.py`
2. Re-run setup: `python tools/setup.py`
3. (Optional) Re-apply PAK mods: `python tools/build_pak.py`
4. Launch: `python launcher/launcher.py`
