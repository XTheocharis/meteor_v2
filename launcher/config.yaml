# Meteor v2 Configuration
# ======================
# Configuration for the privacy-focused Comet browser launcher.

browser:
  executable: ""  # Auto-detected if not specified
  profile: "Default"

  flags:
    # Remote URLs (force perplexity.ai instead of chrome-extension://)
    - "--homepage=https://www.perplexity.ai/b/home"

    # Privacy
    - "--no-pings"
    - "--disable-domain-reliability"
    - "--disable-client-side-phishing-detection"
    - "--ip-protection-proxy-opt-out"
    - "--propagate-iph-for-testing"

    # Extensions - Load modified unpacked extensions
    - "--perplexity-enable-bundle-extension-unpacked-loading"
    - "--enable-experimental-extension-apis"

  enable_features:
    # --- Extension Capabilities ---
    - "ExtensionsOnChromeURLs"
    - "ExtensionsOnExtensionURLs"
    - "AllowLegacyMV2Extensions"

    # --- Privacy ---
    - "webrtc-hide-local-ips-with-mdns"

    # --- Web Capabilities (for apps that need them) ---
    - "DirectSocketsInServiceWorkers"
    - "DirectSocketsInSharedWorkers"
    - "IsolatedWebApps"
    - "IsolatedWebAppDevMode"
    - "MulticastInDirectSockets"
    - "ReadAnythingWithReadability"

  disable_features:
    # MV2 Extension Support (CRITICAL for uBlock Origin)
    # Chrome 140+ has MV2 disabled by default - these flags re-enable it
    - "ExtensionManifestV2DeprecationWarning"
    - "ExtensionManifestV2Disabled"
    - "ExtensionManifestV2Unsupported"

    # --- AI / LLM / Generative Features ---
    - "PromptApiForGeminiNanoMultimodalInput"
    - "OptimizationGuideOnDeviceModel"
    - "TextSafetyClassifier"
    - "ComposeboxUsesChromeComposeClient"
    - "NtpComposeEntrypoint"
    - "NtpComposebox"
    - "TranslationApi"
    - "ContextualCueing"
    - "PermissionsAiV3"
    - "PermissionsAiV4"
    - "PermissionsAiP92"

    # --- Glic (Google Assistant Integration) ---
    - "Glic"
    - "GlicActor"
    - "GlicActorAutofill"
    - "BrowsingHistoryActorIntegrationM1"
    - "GlicCaptureRegion"
    - "GlicPreWarming"
    - "GlicFrePreWarming"
    - "GlicBindPinnedUnboundTab"
    - "GlicSidePanel"

    # --- Google Lens & Visual Search ---
    - "ContextualSearchOpenLensActionUsesThumbnail"
    - "LensAimSuggestions"
    - "LensVideoCitations"
    - "LensSearchZeroStateCsb"
    - "LensReinvocationAffordance"
    - "LensUpdatedFeedbackEntrypoint"

    # --- Omnibox / Search Telemetry ---
    - "ZeroSuggestPrefetching"
    - "ZeroSuggestPrefetchingOnSRP"
    - "ZeroSuggestPrefetchingOnWeb"
    - "LogUrlScoringSignals"
    - "ContextualSearchBoxUsesContextualSearchProvider"
    - "OmniboxContextualSearchOnFocusSuggestions"
    - "OmniboxContextualSuggestions"
    - "OmniboxFocusTriggersWebAndSrpZeroSuggest"
    - "OmniboxOnDeviceHeadSuggestions"
    - "OmniboxEnterpriseSearchAggregator"
    - "OrganicRepeatableQueries"
    - "MlUrlScoreCaching"
    - "MlUrlScoring"
    - "UrlScoringModel"

    # --- Search Engine Prewarming ---
    - "DefaultSearchEnginePrewarm"
    - "DsePreload2"
    - "DsePreload2OnPress"
    - "BookmarkTriggerForPrefetch"
    - "NewTabPageTriggerForPrefetch"
    - "Prewarm"

    # --- Autofill & Payments Telemetry ---
    - "AutofillEnableCreditCardUpload"
    - "AutofillEnableAiBasedAmountExtraction"
    - "AutofillEnableCardInfoRuntimeRetrieval"
    - "AutofillEnablePrefetchingRiskDataForRetrieval"
    - "AutofillEnableSyncingOfLoyaltyCards"
    - "AutofillEnableCardBenefitsForAmericanExpress"
    - "AutofillEnableCardBenefitsForBmo"
    - "AutofillEnableFlatRateCardBenefitsFromCurinos"
    - "AutofillEnableBuyNowPayLaterForKlarna"
    - "AutofillEnableSupportForHomeAndWork"
    - "AutofillEnableSupportForNameAndEmailProfile"
    - "SyncAutofillWalletCredentialData"
    - "ShoppingAlternateServer"
    - "AutofillEnableAmountExtraction"
    - "AutofillEnableBuyNowPayLater"
    - "AutofillEnableBuyNowPayLaterForExternallyLinked"
    - "AutofillEnableBuyNowPayLaterSyncing"
    - "AutofillEnableCardBenefitsIph"
    - "AutofillEnableDownstreamCardAwarenessIph"

    # --- Comet/Perplexity Specific ---
    - "PerplexityAutoupdate"
    - "ChromeWebStoreNavigationThrottle"

    # --- Reporting, Logging & Debugging ---
    - "FeedbackIncludeVariations"
    - "OptimizationGuideDebugLogs"
    - "OptimizationGuideEnableDogfoodLogging"
    - "DataSharingDebugLogs"
    - "EnableNetworkLoggingToFile"
    - "ProtectedAudienceDebugToken"
    - "ProfileSignalsReportingEnabled"
    - "VariationsSeedCorpus"
    - "WindowsSystemTracing"
    - "DataSharing"
    - "PageContentAnnotations"

    # --- Connectivity & Casting ---
    - "MediaRouterCastAllowAllIps"
    - "EnableCrossDevicePrefTracker"
    - "MediaRouter"

    # --- NTP (New Tab Page) Modules & Promos ---
    - "EnableNtpBrowserPromos"
    - "NtpDriveModuleNoSyncRequirement"
    - "MobilePromoOnDesktop"
    - "NtpCustomizeChromeAutoOpen"
    - "NtpMicrosoftAuthenticationModule"
    - "NtpModuleSignInRequirement"
    - "NtpNextFeatures"
    - "NtpOneGoogleBarAsyncBarParts"
    - "NtpRealboxNext"
    - "NtpSearchboxComposeEntrypoint"
    - "NtpTabGroupsModule"
    - "NtpTabGroupsModuleZeroState"

    # --- Media & Picture-in-Picture ---
    - "AutoPictureInPictureForVideoPlayback"
    - "BrowserInitiatedAutomaticPictureInPicture"
    - "VideoPictureInPictureControlsUpdate2024"

    # --- Miscellaneous ---
    - "PdfSaveToDrive"
    - "ReadAnythingDocsIntegration"
    - "ReadAnythingDocsLoadMoreButton"
    - "SRIMessageSignatureEnforcement"

paths:
  # Modified unpacked extensions (extracted from default_apps/*.crx)
  patched_extensions: "./patched_extensions"
  perplexity: "${patched_extensions}/perplexity"
  comet_web_resources: "${patched_extensions}/comet_web_resources"
  agents: "${patched_extensions}/agents"

  # uBlock Origin
  ublock: "./ublock-origin"
  ublock_defaults: "./ublock/ublock-defaults.json"

registry:  # Windows only
  path: "HKCU:\\SOFTWARE\\Policies\\Chromium"
  policies:
    # --- TELEMETRY & DATA COLLECTION ---
    UrlKeyedAnonymizedDataCollectionEnabled: 0
    FeedbackSurveysEnabled: 0
    UserFeedbackAllowed: 0
    DomainReliabilityAllowed: 0
    SafeBrowsingExtendedReportingEnabled: 0
    SafeBrowsingSurveysEnabled: 0

    # --- IDENTITY & SYNC ---
    BrowserSignin: 0
    SyncDisabled: 1
    SigninInterceptionEnabled: 0
    BrowserGuestModeEnforced: 0
    BrowserAddPersonEnabled: 0
    PromotionsEnabled: 0
    CloudManagementEnrollmentMandatory: 0

    # --- GENERATIVE AI & MACHINE LEARNING ---
    AIModeSettings: 1
    AutofillPredictionSettings: 2
    CreateThemesSettings: 2
    DevToolsGenAiSettings: 2
    GeminiActOnWebSettings: 1
    GeminiSettings: 1
    GenAILocalFoundationalModelSettings: 1
    HelpMeWriteSettings: 2
    HistorySearchSettings: 2
    LensOverlaySettings: 1
    TabCompareSettings: 2
    BuiltInAIAPIsEnabled: 0

    # --- BROWSER SERVICES & PREDICTIONS ---
    NetworkPredictionOptions: 2
    SearchSuggestEnabled: 0
    LensDesktopNTPSearchEnabled: 0
    LensRegionSearchEnabled: 0
    LookalikeWarningAllowlistDomains: 0
    PaymentMethodQueryEnabled: 0
    PasswordLeakDetectionEnabled: 0
    PasswordSharingEnabled: 0
    PasswordDismissCompromisedAlertEnabled: 0

    # --- NETWORK & UPDATES ---
    BuiltInDnsClientEnabled: 0
    DNSInterceptionChecksEnabled: 0
    WPADQuickCheckEnabled: 0
    BrowserNetworkTimeQueriesEnabled: 0
    ComponentUpdatesEnabled: 0
    BackgroundModeEnabled: 0
    CloudPrintProxyEnabled: 0

    # --- SAFE BROWSING ---
    SafeBrowsingProtectionLevel: 0
    SafeBrowsingDeepScanningEnabled: 0
    PasswordProtectionWarningTrigger: 0

    # --- PRIVACY SANDBOX & ADVERTISING ---
    PrivacySandboxPromptEnabled: 0
    PrivacySandboxAdMeasurementEnabled: 0
    PrivacySandboxAdTopicsEnabled: 0
    PrivacySandboxSiteEnabledAdsEnabled: 0
    PrivacySandboxFingerprintingProtectionEnabled: 0
    PrivacySandboxIpProtectionEnabled: 0
    RelatedWebsiteSetsEnabled: 0
    AdsSettingForIntrusiveAdsSites: 2

    # --- UI CLEANUP ---
    NTPCardsVisible: 0
    NTPMiddleSlotAnnouncementVisible: 0
    NTPOutlookCardVisible: 0
    NTPSharepointCardVisible: 0
    ShowAppsShortcutInBookmarkBar: 0
    ShoppingListEnabled: 0
    SideSearchEnabled: 0
    GoogleSearchSidePanelEnabled: 0
    ProfilePickerOnStartupAvailability: 1
    DesktopSharingHubEnabled: 0
    SharedClipboardEnabled: 0
    ClickToCallEnabled: 0
    ChromeVariations: 2
    ShowHomeButton: 1
    ShowFullUrlsInAddressBar: 1

    # --- EXTERNAL INTEGRATIONS ---
    CloudAPAuthEnabled: 0

    # --- QUIC PROTOCOL ---
    QuicAllowed: 0

    # --- DEFAULT BROWSER CHECK ---
    DefaultBrowserSettingEnabled: 0

    # --- BROWSER LABS ---
    BrowserLabsEnabled: 0

  # Registry Sub-Keys
  ExtensionInstallForcelist:
    - "cjpalhdlnbpafiamejdnhcphjbkeiagm;https://clients2.google.com/service/update2/crx"  # uBlock Origin

  MandatoryExtensionsForIncognitoNavigation:
    - "cjpalhdlnbpafiamejdnhcphjbkeiagm"  # uBlock Origin

  PrinterTypeDenyList:
    - "cloud"  # Disable cloud printing
